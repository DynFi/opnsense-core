From 69799b9ef62932f655cad962c81fe28e2cb1cd15 Mon Sep 17 00:00:00 2001
From: Dawid Kujawa <dawid.kujawa@vectus.pl>
Date: Thu, 30 May 2019 18:10:13 +0200
Subject: [PATCH 2/3] Rewriting menu system to use SVGs instead of FontIcons

---
 .../models/OPNsense/Base/Menu/MenuItem.php    | 24 +++++++++++++++++++
 .../app/models/OPNsense/Core/Menu/Menu.xml    |  4 ++--
 src/www/fbegin.inc                            | 16 +++++++++++--
 3 files changed, 40 insertions(+), 4 deletions(-)

diff --git a/src/opnsense/mvc/app/models/OPNsense/Base/Menu/MenuItem.php b/src/opnsense/mvc/app/models/OPNsense/Base/Menu/MenuItem.php
index 3c338ea60..8b223e179 100644
--- a/src/opnsense/mvc/app/models/OPNsense/Base/Menu/MenuItem.php
+++ b/src/opnsense/mvc/app/models/OPNsense/Base/Menu/MenuItem.php
@@ -66,6 +66,12 @@ class MenuItem
      */
     private $CssClass = "";
 
+    /**
+     * layout information, icon
+     * @var string
+     */
+    private $SvgIcon = "";
+
     /**
      * link to url location
      * @var string
@@ -226,6 +232,15 @@ class MenuItem
         $this->CssClass = $value;
     }
 
+    /**
+     * setter for SvgIcon field
+     * @param $value
+     */
+    public function setSvgIcon($value)
+    {
+        $this->SvgIcon = $value;
+    }
+
     /**
      * getter for cssclass
      * @return string
@@ -235,6 +250,15 @@ class MenuItem
         return $this->CssClass;
     }
 
+    /**
+     * getter for SvgIcon
+     * @return string
+     */
+    public function getSvgIcon()
+    {
+        return $this->SvgIcon;
+    }
+
     /**
      * setter for url field
      * @param $value
diff --git a/src/opnsense/mvc/app/models/OPNsense/Core/Menu/Menu.xml b/src/opnsense/mvc/app/models/OPNsense/Core/Menu/Menu.xml
index 91ecc16f6..e21bca96c 100644
--- a/src/opnsense/mvc/app/models/OPNsense/Core/Menu/Menu.xml
+++ b/src/opnsense/mvc/app/models/OPNsense/Core/Menu/Menu.xml
@@ -1,6 +1,6 @@
 <menu>
-    <Lobby order="10" cssClass="fa fa-laptop">
-        <Dashboard order="0" url="/index.php" cssClass="fa fa-dashboard fa-fw">
+    <Lobby order="10" cssClass="fa fa-laptop" svgIcon="view-column">
+        <Dashboard order="0" url="/index.php" cssClass="fa fa-dashboard fa-fw" svgIcon="dashboard">
             <Args url="/index.php*" visibility="hidden"/>
             <Root url="/" visibility="hidden"/>
             <RootArgs url="/?*" visibility="hidden"/>
diff --git a/src/www/fbegin.inc b/src/www/fbegin.inc
index 70af58a6f..8fd3762cc 100644
--- a/src/www/fbegin.inc
+++ b/src/www/fbegin.inc
@@ -98,7 +98,13 @@ if($need_alert_display == true) {
                           foreach($menuSystem as $topMenuItem): ?>
 <?php
                           if (count($topMenuItem->Children) >= 1): ?>
-                            <a href="#<?=$topMenuItem->Id;?>" class="list-group-item <?= $topMenuItem->Selected ? 'active-menu-title' : ''; ?>" data-toggle="collapse" data-parent="#mainmenu"><span class="<?=$topMenuItem->CssClass;?> __iconspacer"></span><?=gettext($topMenuItem->VisibleName);?>  </a>
+                            <a href="#<?=$topMenuItem->Id;?>" class="list-group-item <?= $topMenuItem->Selected ? 'active-menu-title' : ''; ?>" data-toggle="collapse" data-parent="#mainmenu">
+                              <?php if ($topMenuItem->SvgIcon): ?>
+                                <?= include('/usr/local/opnsense/www/icons/'.$topMenuItem->SvgIcon.'.svg'); ?>
+                              <?php else: ?>
+                                <span class="<?=$topMenuItem->CssClass;?> __iconspacer"></span><?=gettext($topMenuItem->VisibleName);?>
+                              <?php endif ?>
+                            </a>
                             <div class="collapse <?=$topMenuItem->Selected ? 'active-menu in' :'';?>" id="<?=$topMenuItem->Id;?>">
 <?php
                             foreach($topMenuItem->Children as $subMenuItem): ?>
@@ -108,7 +114,13 @@ if($need_alert_display == true) {
                                   <div style="display: table;width: 100%;">
                                     <div style="display: table-row">
                                       <div style="display: table-cell"><?=gettext($subMenuItem->VisibleName);?></div>
-                                        <div style="display: table-cell; text-align:right; vertical-align:middle;"><span class="<?=$subMenuItem->CssClass;?>"></span></div>
+                                        <div style="display: table-cell; text-align:right; vertical-align:middle;">
+                                          <?php if ($subMenuItem->SvgIcon): ?>
+                                            <?= include('/usr/local/opnsense/www/icons/'.$subMenuItem->SvgIcon.'.svg'); ?>
+                                          <?php else: ?>
+                                            <span class="<?=$subMenuItem->CssClass;?>"></span>
+                                          <?php endif ?>
+                                        </div>
                                       </div>
                                   </div>
                                </a>
-- 
2.20.1

